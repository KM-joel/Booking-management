<odoo>
  <data>
    <!-- explicit list view definition -->

    <record model="ir.ui.view" id="reservation_tree">
      <field name="name">reservation_tree</field>
      <field name="model">reservation.reservation</field>
      <field name="arch" type="xml">
        <tree>
          <field name="reference"/>
          <field name="client_id"/>
          <field name="article_id"/>
          <field name="reservation_date"/>
          <field name="state"
                 string="Status"
                 widget="badge"
                 decoration-primary="state == 'new'"
                 decoration-warning="state == 'confirmed'"
                 decoration-success="state == 'validated'"
                 decoration-danger="state == 'canceled'"/>
          <field name="end_date_reservation"/>
        </tree>
      </field>
    </record>

    <!-- explicit form view definition -->

    <record model="ir.ui.view" id="reservation_form">
      <field name="name">reservation_form</field>
      <field name="model">reservation.reservation</field>
      <field name="arch" type="xml">
        <form>
          <header>
            <button string="Next step"
                    type="object"
                    name="next_step"
                    class="oe_highlight"
                    attrs="{'invisible': [('state', '=', 'canceled')]}"/>
            <button string="New"
                    type="object"
                    name="canceled_reservation"
                    class="oe_highlight"
                    states="canceled"/>
            <button string="Cancel the reservation"
                    type="object"
                    name="canceled_reservation"
                    class="oe_highlight"
                    states="validated"/>
            <button string="Create a quote"
                      type="object"
                      name="create_quote"
                      class="oe_highlight"
                      states="validated"/>
            <field name="state" widget="statusbar"/>
          </header>
          <sheet>
            <div class="oe_title">
              <label for="reference"/>
                <h1>
                  <field name="reference"/>
                </h1>
            </div>
            <group>
              <group>
                <field name="client_id"/>
                <field name="article_id"/>
                <field name="reservation_date"/>
                <field name="end_date_reservation"/>
              </group>
              <group>
                <field name="reservation_duration_hours"/>
                <field name="reservation_duration_day"/>
                <field name="reservation_duration_month"/>
              </group>
            </group>
            <notebook>
              <page string="List of quotation">
                <field name="article_id"/>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

     <!-- explicit kanban view definition -->

    <record id="reservation_kanban" model="ir.ui.view">
      <field name="name">gestion des reservations kanban</field>
      <field name="model">reservation.reservation</field>
      <field name="arch" type="xml">
          <kanban class="o_res_partner_kanban">
            <templates>
              <t t-name="kanban-box">
                <div t-attf-class="oe_kanban_global_click">
                  <div class="oe_kanban_details">
                    <strong class="o_kanban_record_title">
                      <span><field name="client_id"/></span>
                    </strong>
                    <div>
                      <strong>
                        <field name="reservation_duration_hours"/> Heure
                        <field name="reservation_duration_day"/> Jour
                        <field name="reservation_duration_month"/> Mois
                      </strong>
                    </div>
                    <div>
                      <span>
                        <field name="reference"/>
                      </span>
                      <div>
                        <field name="reservation_date"/>
                        <field name="state"
                               widget="badge"
                               decoration-primary="state == 'new'"
                               decoration-warning="state == 'confirmed'"
                               decoration-success="state == 'validated'"
                               decoration-danger="state == 'canceled'"/>
                      </div>
                    </div>
                  </div>
                </div>
              </t>
            </templates>
          </kanban>
      </field>
    </record>

    <!-- explicit search view definition -->

    <record model="ir.ui.view" id="reservation_search">
      <field name="name">reservation_search</field>
      <field name="model">reservation.reservation</field>
      <field name="arch" type="xml">
        <search string="Search par reservation">
          <field name="reference"/>
          <field name="client_id"/>
          <field name="article_id"/>
          <field name="reservation_date"/>
          <field name="end_date_reservation"/>
          <separator/>
          <filter string="Nouvelle" name="filter_by_new" domain="[('state', '=', 'new')]"/>
          <filter string="Confirmee" name="filter_by_confirmed" domain="[('state', '=', 'confirmed')]"/>
          <filter string="Validee" name="filter_by_validated" domain="[('state', '=', 'validated')]"/>
          <filter string="Annulee" name="filter_by_canceled" domain="[('state', '=', 'canceled')]"/>
          <group string="Group by">
            <filter name="by_client" string="Client" context="{'group_by': 'client_id'}"/>
            <filter name="by_reservation" string="Date de reservation" context="{'group_by': 'reservation_date:month'}"/>
            <filter name="by_article" string="Article" context="{'group_by': 'article_id'}"/>
          </group>
        </search>
      </field>
    </record>

    <!-- explicit graph view definition -->

    <record model="ir.ui.view" id="reservation_graph">
      <field name="name">reservation_graph</field>
      <field name="model">reservation.reservation</field>
      <field name="arch" type="xml">
        <graph type="pie">
          <field name="reservation_date" interval="month"/>
        </graph>
      </field>
    </record>

    <record model="ir.ui.view" id="reservation_pivot">
      <field name="name">reservation_pivot</field>
      <field name="model">reservation.reservation</field>
      <field name="arch" type="xml">
        <pivot>
          <field name="total_duration_hours" type="measure"/>
        </pivot>
      </field>
    </record>

    <!-- actions opening views on models -->

    <record model="ir.actions.act_window" id="reservation.reservation_all_action_window">
      <field name="name">Reservation all</field>
      <field name="res_model">reservation.reservation</field>
      <field name="view_mode">tree,form,kanban,search</field>
    </record>

    <record model="ir.actions.act_window" id="reservation.reservations_user_action_window">
      <field name="name">Reservation all for connected user</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">reservation.reservation</field>
      <field name="view_mode">tree,form</field>
      <field name="domain">[('client_id', '=', uid)]</field>
    </record>

    <record model="ir.actions.act_window" id="analyse_client_act_window">
      <field name="name">All client who have made at least one reservation</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">res.users</field>
      <field name="view_mode">tree</field>
      <field name="domain">[('reservation_ids.state', 'in', ['new', 'confirmed', 'validated'])]</field>
    </record>

    <record model="ir.actions.act_window" id="analyse_sale_act_window">
      <field name="name">All the quote created since reservation</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">sale.order</field>
      <field name="view_mode">tree</field>
      <field name="domain">[('active_devis', '=', True)]</field>
    </record>

    <record model="ir.actions.act_window" id="reporting_month_act_window">
      <field name="name">My reservation by month</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">reservation.reservation</field>
      <field name="view_mode">pivot,graph</field>
      <field name="context">{'group_by': 'reservation_date:month'}</field>
      <field name="domain">[('state', '!=', 'canceled')]</field>
<!--      <filter name="groupby_create_date" string="Creation Date" context="{'group_by': 'reservation_date:month'}"/>-->
    </record>

    <record model="ir.actions.act_window" id="reporting_canceled_month_act_window">
      <field name="name">My reservation canceled by month</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">reservation.reservation</field>
      <field name="view_mode">pivot,graph</field>
      <field name="domain">[('state', '=', 'canceled')]</field>
      <field name="context">{'group_by': 'reservation_date:month'}</field>
<!--      <field name="context">{'group_by': 'reservation_date:month'}</field>-->
<!--      <field name="domain">[('devis.name', 'like', 'reference')]</field>-->
<!--      <filter name="groupby_create_date" string="Creation Date" context="{'group_by': 'reservation_date:month'}"/>-->
    </record>

    <record model="ir.actions.act_window" id="reporting_hours_month_act_window">
      <field name="name">Total reservation hours by month</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">reservation.reservation</field>
      <field name="view_mode">pivot</field>
      <field name="view_id" ref="reservation.reservation_pivot"/>
      <field name="domain">[('state', 'not in', ['new', 'canceled'])]</field>
      <field name="context">{'group_by': 'reservation_date:month'}</field>
<!--      <field name="context">{'group_by': 'reservation_date:month'}</field>'search_default_group_by_reservation_date': 1,, 'pivot_measures': ['total_duration_hours']-->
<!--      <field name="domain">[('devis.name', 'like', 'reference')]</field>-->
<!--      <filter name="groupby_create_date" string="Creation Date" context="{'group_by': 'reservation_date:month'}"/>-->
    </record>
  </data>
</odoo>